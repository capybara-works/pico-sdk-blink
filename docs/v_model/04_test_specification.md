# テスト仕様書 (Test Specification Document)

## 1. テスト方針
本プロジェクトでは、ローカル環境およびCI環境（GitHub Actions）において、自動化されたテストを実施する。

## 2. 単体テスト (Unit Test)
### 2.1 ビルド検証
*   **テストID**: UT-001
*   **目的**: ソースコードが正常にコンパイル・リンクできることを確認する。
*   **手順**: `cmake --build .` を実行する。
*   **合格基準**: エラーなく終了し、実行バイナリ（`blink.elf`, `blink.uf2`）が生成されること。

### 2.2 サイズチェック
*   **テストID**: UT-002
*   **目的**: 生成されたバイナリが有効であることを簡易的に確認する。
*   **手順**: CTestの `size_check` テストを実行する（`arm-none-eabi-size` コマンドを使用）。
*   **合格基準**: コマンドが正常終了すること。

## 3. 結合テスト (Integration Test)
Wokwiシミュレータを使用したハードウェア・ソフトウェア連携テストを実施する。

### 3.1 シナリオテスト: Lチカとログ出力
*   **テストID**: IT-001
*   **目的**: LEDの点滅とシリアルログ出力が仕様通り同期していることを確認する。
*   **定義ファイル**: `blink.test.yaml`
*   **手順**:
    1.  シミュレーションを開始する。
    2.  シリアル出力 "LED on" を待機する。
    3.  (内部LEDのため、ピン状態の直接検証はスキップし、ロジック到達をシリアルログで確認する)
    4.  シリアル出力 "LED off" を待機する。
*   **合格基準**: 上記ステップがタイムアウト（5000ms）内に全て成功すること。

## 4. CI/CD検証 (System Verification)
GitHub Actions (`.github/workflows/ci.yml`) 上で以下のプロセスが正常に完了することを以て、システム全体の健全性を保証する。

### 4.1 ビルド検証ジョブ (build-and-test)
1.  **Checkout**: リポジトリの取得。
2.  **Toolchain Setup**: ARM GCC, CMake のインストール。
3.  **SDK Setup**: Pico SDK (v2.0.0) の取得とキャッシュ。
4.  **Build & Test**: `build_and_test.sh` の実行（Configure, Build, CTest）。
5.  **Artifact Upload**: 生成されたファームウェア (`blink.uf2`, `blink.elf`) の保存。

### 4.2 Wokwi統合テストジョブ (test-on-wokwi)
*   **テストID**: SV-001
*   **依存関係**: `build-and-test` ジョブの正常完了
*   **目的**: シミュレータ環境でのハードウェア・ソフトウェア統合動作を検証する。
*   **実行環境**: `wokwi/wokwi-ci-action@v1`
*   **手順**:
    1.  ビルド済みファームウェア (`blink.uf2`, `blink.elf`) をアーティファクトからダウンロード。
    2.  Wokwi CIアクションでシミュレーションを起動。
    3.  `blink.test.yaml` で定義されたテストシナリオ (IT-001) を実行。
    4.  シリアル出力とピン状態の検証結果を取得。
*   **必須設定**: GitHubリポジトリシークレット `WOKWI_CLI_TOKEN` の設定
*   **タイムアウト**: 5000ms
*   **合格基準**: テストシナリオの全ステップがタイムアウト内に成功すること。
